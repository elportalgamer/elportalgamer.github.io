
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>El Portal Gamer â€” ReseÃ±as y retro</title>

  <link rel="canonical" href="https://www.elportalgamer.com/" />
  <link rel="icon" type="image/png" href="mago.png" />

  <!-- Open Graph / Twitter -->
  <meta name="description" content="ReseÃ±as sinceras, retro y rarezas: PS1, PS2, Dreamcast, JRPG y survival horror. Videos y mini-reseÃ±as en El Portal Gamer." />
  <meta property="og:title" content="El Portal Gamer â€” ReseÃ±as y retro" />
  <meta property="og:description" content="ReseÃ±as sinceras, retro y rarezas: PS1, PS2, Dreamcast, JRPG y survival horror." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.elportalgamer.com/" />
  <meta property="og:image" content="https://www.elportalgamer.com/og.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="El Portal Gamer â€” ReseÃ±as y retro" />
  <meta name="twitter:description" content="ReseÃ±as sinceras, retro y rarezas: PS1, PS2, Dreamcast, JRPG y survival horror." />
  <meta name="twitter:image" content="https://www.elportalgamer.com/og.jpg" />

  <style>
    :root{
      --bg:#121212; --surface:#1f1f1f; --text:#f0f0f0; --muted:#b5b5b5; --brand:#ff4500; --card:#171717;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{ margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial; background:var(--bg); color:var(--text); }
    header{ position:sticky; top:0; z-index:5; background:#161616; border-bottom:1px solid #242424; }
    .nav{ max-width:1100px; margin:0 auto; display:flex; align-items:center; gap:16px; padding:12px 16px; }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; font-size:1.25rem; color:var(--brand)}
    .brand img{height:34px;width:auto;border-radius:6px}
    .nav a{color:#eaeaea;text-decoration:none;opacity:.9}
    .nav a:hover{opacity:1}
    .spacer{flex:1}
    .search{width:320px; max-width:55vw; padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0f0f0f; color:#fff}
    .lang{padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0f0f0f; color:#fff}

    main{max-width:1100px; margin:20px auto; padding:0 16px}
    section{margin:24px 0}
    h2{margin:0 0 12px; font-size:1.25rem}
    .sub{color:var(--muted); font-size:.95rem; margin:4px 0 14px}

    .grid{display:grid; gap:16px}
    .grid.cols-3{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .grid.cols-2{grid-template-columns:repeat(auto-fill,minmax(360px,1fr))}

    .card{background:var(--surface); border:1px solid #262626; border-radius:var(--radius); overflow:hidden}
    .card.pad{padding:14px}
    .row{display:flex; gap:16px; align-items:center}

    /* Lite YouTube */
    .videobox{position:relative; width:100%; padding-top:56.25%; overflow:hidden; background:#000; border-bottom:1px solid #262626}
    .lite-yt{ position:absolute; inset:0; background-position:center; background-size:cover; cursor:pointer; }
    .lite-yt::before{ content:""; position:absolute; inset:0; background:linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,.05)); }
    .lty-playbtn{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      width:72px; height:52px; border:0; border-radius:10px; background:rgba(0,0,0,.6);
      display:grid; place-items:center; box-shadow:0 8px 20px rgba(0,0,0,.45); }
    .lty-playbtn svg{width:28px;height:28px;fill:#fff}
    iframe{position:absolute; inset:0; width:100%; height:100%; border:0}

    .title{font-weight:700; margin:8px 0 6px; font-size:1.05rem}
    .desc{color:#cfcfcf; font-size:.95rem; line-height:1.45; max-height:4.5em; overflow:hidden}
    .desc.expanded{max-height:600px}
    .muted{color:var(--muted); font-size:.9rem}
    .btn{ display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:10px; border:1px solid #333; background:#151515; color:#fff; text-decoration:none; }
    .btn.brand{background:var(--brand); border-color:#ff5e1f; color:#111; font-weight:800}

    /* Divider */
    .divider{height:8px; border-radius:999px; margin:22px 0 14px; background:linear-gradient(90deg,#202020,#ff6a1a,#202020); opacity:.9}

    /* Noticias (cuadrado HD) */
    .news-thumb{position:relative; width:100%; padding-top:100%; background:#0e0e0e; border-radius:10px; overflow:hidden; border:1px solid #262626}
    .news-thumb img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .news-meta{display:flex; gap:10px; align-items:center; color:#cfcfcf; font-size:.9rem; margin:6px 0 10px}
    .badge{font-size:.75rem; border:1px solid #333; padding:4px 8px; border-radius:999px; color:#ffcfbd; background:#1b0f0a}

    /* Redes */
    .socials{display:flex; flex-wrap:wrap; gap:12px}
    .socials a{ display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:10px; border:1px solid #333; background:#151515; color:#fff; text-decoration:none; }
    .socials svg{width:18px; height:18px}

    /* Contacto */
    label { display:block; margin:8px 0 12px; font-size:.95rem; }
    input, textarea, select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0f0f0f; color:#fff; }
    input:focus, textarea:focus, select:focus { outline:2px solid var(--brand); outline-offset:2px; }
    .form-grid { display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); }
    button.btn { cursor:pointer; }

    footer{margin:40px 0 20px; color:#9b9b9b; text-align:center}
    @media (max-width:560px){ .search{width:100%} .nav{flex-wrap:wrap} }
  </style>
</head>
<body>
<header>
  <div class="nav">
    <div class="brand"><img src="mago.png" alt="Logo" />El Portal Gamer</div>
    <a href="#ultimo" data-i18n="nav.home">Inicio</a>
    <a href="#reviews" data-i18n="nav.reviews">ReseÃ±as</a>
    <a href="#series" data-i18n="nav.series">Series</a>
    <a href="videos.html" data-i18n="nav.videos">Videos</a>
    <a href="#news" data-i18n="nav.news">Noticias</a>
    <a href="#apoya" data-i18n="nav.support">Apoya el canal</a>
    <a href="#contacto" data-i18n="nav.contact">Contacto</a>
    <div class="spacer"></div>
    <input id="buscador" class="search" type="search" placeholder="Buscar video, reseÃ±a o noticiaâ€¦" />
    <select id="lang-select" class="lang" aria-label="Language">
      <option value="es">ES</option>
      <option value="en">EN</option>
    </select>
  </div>
</header>

<main>
  <!-- Ãšltimo Video -->
  <section id="ultimo">
    <h2 data-i18n="h.lastVideo">Ãšltimo video</h2>
    <div class="card">
      <div class="videobox" id="ultimo-lite"></div>
      <div class="pad">
        <div class="title" id="ultimo-titulo">Cargandoâ€¦</div>
        <div class="muted" id="ultimo-fecha"></div>
        <p class="desc" id="ultimo-desc"></p>
        <div class="row">
          <a id="ultimo-ver" class="btn brand" target="_blank" rel="noopener" data-i18n="btn.watchOnYT">â–¶ Ver en YouTube</a>
          <a id="ultimo-oferta" class="btn" target="_blank" rel="noopener" data-i18n="btn.deals">ðŸŽ® Ver Juegos en Oferta</a>
        </div>
      </div>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Noticias -->
  <section id="news">
    <h2 data-i18n="h.news">Noticias</h2>
    <div class="grid cols-3" id="news-grid"></div>
    <div id="news-error" class="muted" style="margin-top:6px; display:none" data-i18n="msg.newsError">No se pudieron cargar las noticias.</div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- ReseÃ±as -->
  <section id="reviews">
    <h2 data-i18n="h.reviews">ReseÃ±as</h2>
    <div class="grid cols-3" id="mini-grid"></div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Series -->
  <section id="series">
    <h2 data-i18n="h.series">Series</h2>
    <div class="grid cols-2" id="series-grid"></div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Apoya el canal -->
  <section id="apoya">
    <h2 data-i18n="h.support">Apoya el canal</h2>
    <div class="card pad">
      <div class="row" style="flex-wrap:wrap">
        <a class="btn brand" href="https://ko-fi.com/portalgamer" target="_blank" rel="noopener">â˜• Ko-fi</a>
        <a class="btn" href="https://www.instant-gaming.com/es/?igr=portalgamerx" target="_blank" rel="noopener" data-i18n="btn.deals">ðŸŽ® Ver Juegos en Oferta</a>
        <a class="btn" href="https://www.amazon.com/shop/viajealodesconocido" target="_blank" rel="noopener">ðŸ›’ Amazon</a>
      </div>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Redes -->
  <section id="redes">
    <h2 data-i18n="h.socials">Redes</h2>
    <div class="socials">
      <a href="https://www.facebook.com/ElPortalGamerX" target="_blank" rel="noopener" aria-label="Facebook">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 12.06C22 6.49 17.52 2 12 2S2 6.49 2 12.06c0 5 3.66 9.15 8.44 9.94v-7.03H7.9v-2.91h2.54V9.41c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.24.2 2.24.2v2.46h-1.26c-1.24 0-1.63.77-1.63 1.56v1.87h2.78l-.44 2.91h-2.34V22c4.78-.79 8.44-4.94 8.44-9.94z"/></svg>
        Facebook
      </a>
      <a href="https://www.instagram.com/elportalgamerx" target="_blank" rel="noopener" aria-label="Instagram">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5.8A4.2 4.2 0 1 0 16.2 12 4.2 4.2 0 0 0 12 7.8zm0 6.9A2.7 2.7 0 1 1 14.7 12 2.7 2.7 0 0 1 12 14.7zM18.4 6.6a1.2 1.2 0 1 0 1.2 1.2 1.2 1.2 0 0 0-1.2-1.2z"/></svg>
        Instagram
      </a>
      <a href="https://www.twitch.tv/soypaulangel" target="_blank" rel="noopener" aria-label="Twitch">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 2 3 6v13h5v3h3l3-3h4l3-3V2H4zm16 11-2 2h-5l-3 3v-3H7V4h13v9zM18 6h-2v5h2V6zm-5 0h-2v5h2V6z"/></svg>
        Twitch
      </a>
    </div>
  </section>

  <div class="divider" aria-hidden="true"></div>

  <!-- Contacto -->
  <section id="contacto">
    <h2 data-i18n="h.contact">Contacto</h2>
    <div class="card pad">
      <form id="contact-form" method="POST" novalidate>
        <div class="form-grid">
          <label data-i18n="form.nameLabel">Nombre
            <input type="text" name="name" required>
          </label>
          <label data-i18n="form.emailLabel">Email
            <input type="email" name="email" required>
          </label>
        </div>
        <label data-i18n="form.subjectLabel">Asunto
          <input type="text" name="subject">
        </label>
        <label data-i18n="form.messageLabel">Mensaje
          <textarea name="message" rows="6" required></textarea>
        </label>

        <!-- Honeypot anti-spam -->
        <input type="text" name="_gotcha" style="display:none" tabindex="-1" autocomplete="off">

        <div class="row">
          <button type="submit" class="btn brand" data-i18n="btn.send">ðŸ“¨ Enviar</button>
        </div>

        <p id="form-result" class="muted" aria-live="polite"></p>
      </form>
    </div>
  </section>
</main>

<footer>Â© <span id="year"></span> El Portal Gamer</footer>

<!-- JSON-LD del sitio -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"WebSite",
  "name":"El Portal Gamer",
  "url":"https://www.elportalgamer.com/",
  "potentialAction":{
    "@type":"SearchAction",
    "target":"https://www.elportalgamer.com/?q={search_term_string}",
    "query-input":"required name=search_term_string"
  }
}
</script>

<script defer>
/* ================================
 *  CONFIG
 * ================================ */
const API_KEY = "AIzaSyCqPlM0Ab3-_mtFHPmrrgJTS1S4dBCbbMA";
const PLAYLIST_ID = "PLk3cei5OOiyvTQzg5FGgIRY3xs44F7Wzv";
const MAX_RESULTS = 20;
const FALLBACK_VIDEO_ID = "";
const BLOGGER_JSONP = "https://portalgamerok.blogspot.com/feeds/posts/default?alt=json-in-script&max-results=3&orderby=published";
const DEFAULT_NEWS_IMAGE = "og.jpg";
const NEWS_BRAND_NAME = "El Portal Gamer";
const FORMSPREE_ID = "mjkejwvg"; // https://formspree.io/f/mjkejwvg

/* ================================
 *  i18n
 * ================================ */
const I18N = {
  es: {
    "nav.home":"Inicio","nav.reviews":"ReseÃ±as","nav.series":"Series","nav.videos":"Videos","nav.news":"Noticias","nav.support":"Apoya el canal","nav.contact":"Contacto",
    "h.lastVideo":"Ãšltimo video","h.news":"Noticias","h.reviews":"ReseÃ±as","h.series":"Series","h.support":"Apoya el canal","h.contact":"Contacto","h.socials":"Redes",
    "btn.watchOnYT":"â–¶ Ver en YouTube","btn.deals":"ðŸŽ® Ver Juegos en Oferta","btn.send":"ðŸ“¨ Enviar",
    "form.nameLabel":"Nombre","form.emailLabel":"Email","form.subjectLabel":"Asunto","form.messageLabel":"Mensaje",
    "msg.newsError":"No se pudieron cargar las noticias.",
    "ph.search":"Buscar video, reseÃ±a o noticiaâ€¦",
    "badge.news":"Noticia",
    "time.ago":"hace {n} {u}",
    "time.now":"ahora",
    "time.units":{"y":"a","mo":"m","w":"sem","d":"d","h":"h","m":"min"}
  },
  en: {
    "nav.home":"Home","nav.reviews":"Reviews","nav.series":"Series","nav.videos":"Videos","nav.news":"News","nav.support":"Support","nav.contact":"Contact",
    "h.lastVideo":"Latest video","h.news":"News","h.reviews":"Reviews","h.series":"Series","h.support":"Support the channel","h.contact":"Contact","h.socials":"Social",
    "btn.watchOnYT":"â–¶ Watch on YouTube","btn.deals":"ðŸŽ® See Game Deals","btn.send":"ðŸ“¨ Send",
    "form.nameLabel":"Name","form.emailLabel":"Email","form.subjectLabel":"Subject","form.messageLabel":"Message",
    "msg.newsError":"Couldn't load news.",
    "ph.search":"Search video, review or newsâ€¦",
    "badge.news":"News",
    "time.ago":"{n} {u} ago",
    "time.now":"now",
    "time.units":{"y":"y","mo":"mo","w":"w","d":"d","h":"h","m":"min"}
  }
};
const $ = (s, p=document) => p.querySelector(s);
const $$ = (s, p=document) => [...p.querySelectorAll(s)];
let YT_ITEMS = [];
let NEWS_ITEMS = [];

// Detect / set language
function detectLang(){
  const urlLang = new URLSearchParams(location.search).get("lang");
  const saved = localStorage.getItem("lang");
  const nav = navigator.languages?.[0] || navigator.language || "es";
  let lang = (urlLang || saved || nav || "es").toLowerCase();
  if (lang.startsWith("en")) lang = "en";
  else lang = "es";
  return lang;
}
let LANG = detectLang();
$("#lang-select").value = LANG;

function t(key){ return I18N[LANG]?.[key] || key; }

function applyI18n(){
  // visible labels
  $$("[data-i18n]").forEach(el=>{
    const key = el.getAttribute("data-i18n");
    el.textContent = t(key);
  });
  // placeholder
  $("#buscador").placeholder = t("ph.search");

  // re-render dynamic sections (so buttons/labels salgan traducidos)
  if(YT_ITEMS.length){
    renderUltimo(YT_ITEMS[0]);
    renderMini(YT_ITEMS.slice(1, 10));
    renderSeries(YT_ITEMS);
  }
  if(NEWS_ITEMS.length){
    renderNews(NEWS_ITEMS);
  }
  // dates
  if(YT_ITEMS[0]) $("#ultimo-fecha").textContent = new Date(YT_ITEMS[0].date).toLocaleDateString(LANG);
}
$("#lang-select").addEventListener("change", ()=>{
  LANG = $("#lang-select").value;
  localStorage.setItem("lang", LANG);
  applyI18n();
});

/* ================================
 *  Helpers
 * ================================ */
const truncate = (str, n) => (str||"").length>n ? str.slice(0,n).replace(/\s+\S*$/,'')+"â€¦" : str;
const words = (x)=> (x||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();

function timeAgo(iso){
  const d = new Date(iso); const diff = (Date.now() - d.getTime())/1000;
  const units = [
    [31536000,'y'],[2592000,'mo'],[604800,'w'],[86400,'d'],[3600,'h'],[60,'m']
  ];
  for(const [s,u] of units){
    if(diff>=s){
      const n = Math.floor(diff/s);
      const uKey = I18N[LANG]["time.units"][u];
      const pat = I18N[LANG]["time.ago"];
      return pat.replace("{n}", n).replace("{u}", uKey);
    }
  }
  return I18N[LANG]["time.now"];
}

function upsizeBloggerImage(url, size = 800){
  if(!url) return "";
  return url
    .replace(/\/s\d+(-c)?\//, `/s${size}/`)
    .replace(/=s\d+(-c)?/, `=s${size}`)
    .replace(/\/w\d+-h\d+(-c)?\//, `/s${size}/`);
}
function extractImgFromHtml(html){
  const m = (html||"").match(/<img[^>]+src=["']([^"']+)["']/i);
  return m ? m[1] : "";
}

/* ================================
 *  YOUTUBE
 * ================================ */
function renderUltimo(v){
  const box = $("#ultimo-lite");
  box.className = "videobox";
  const lite = document.createElement("div");
  lite.className = "lite-yt";
  lite.style.backgroundImage = `url(${v.thumb})`;
  lite.innerHTML = `
    <button class="lty-playbtn" aria-label="${t("btn.watchOnYT")}">
      <svg viewBox="0 0 68 48"><path d="M66.52 7.02a8 8 0 0 0-5.64-5.66C56.8 0 34 0 34 0S11.2 0 7.12 1.36A8 8 0 0 0 1.48 7.02 83.3 83.3 0 0 0 0 24a83.3 83.3 0 0 0 1.48 16.98 8 8 0 0 0 5.64 5.66C11.2 48 34 48 34 48s22.8 0 26.88-1.36a8 8 0 0 0 5.64-5.66A83.3 83.3 0 0 0 68 24a83.3 83.3 0 0 0-1.48-16.98zM27 34V14l18 10-18 10z"/></svg>
    </button>`;
  lite.addEventListener("click", ()=>{
    box.innerHTML = `<iframe src="https://www.youtube.com/embed/${v.id}?autoplay=1" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="${v.title}"></iframe>`;
  });
  box.innerHTML = ""; box.appendChild(lite);

  $("#ultimo-titulo").textContent = v.title;
  $("#ultimo-fecha").textContent = new Date(v.date).toLocaleDateString(LANG);
  $("#ultimo-desc").textContent = truncate(v.desc, 420);
  $("#ultimo-ver").href = `https://www.youtube.com/watch?v=${v.id}`;
  $("#ultimo-oferta").href = "https://www.instant-gaming.com/es/?igr=portalgamerx";

  // JSON-LD dinÃ¡mico del Ãºltimo video
  const ld = {
    "@context":"https://schema.org","@type":"VideoObject",
    "name": v.title,"description": truncate(v.desc, 220),
    "thumbnailUrl":[v.thumb],"uploadDate": v.date,
    "embedUrl": `https://www.youtube.com/embed/${v.id}`,
    "publisher":{"@type":"Organization","name":"El Portal Gamer"},
    "potentialAction":{"@type":"WatchAction","target":[`https://www.youtube.com/watch?v=${v.id}`]}
  };
  let s = document.getElementById("ld-video"); if (s) s.remove();
  s = document.createElement("script"); s.type="application/ld+json"; s.id="ld-video";
  s.textContent = JSON.stringify(ld); document.head.appendChild(s);
}

function makeMiniCard(v){
  const el = document.createElement("article");
  el.className = "card pad filterable";
  el.dataset.title = v.title; el.dataset.desc = v.desc;
  el.innerHTML = `
    <div class="videobox">
      <div class="lite-yt" style="background-image:url(${v.thumb})">
        <button class="lty-playbtn" aria-label="${t("btn.watchOnYT")}">
          <svg viewBox="0 0 68 48"><path d="M66.52 7.02a8 8 0 0 0-5.64-5.66C56.8 0 34 0 34 0S11.2 0 7.12 1.36A8 8 0 0 0 1.48 7.02 83.3 83.3 0 0 0 0 24a83.3 83.3 0 0 0 1.48 16.98 8 8 0 0 0 5.64 5.66C11.2 48 34 48 34 48s22.8 0 26.88-1.36a8 8 0 0 0 5.64-5.66A83.3 83.3 0 0 0 68 24a83.3 83.3 0 0 0-1.48-16.98zM27 34V14l18 10-18 10z"/></svg>
        </button>
      </div>
    </div>
    <div class="title">${v.title}</div>
    <p class="desc">${truncate(v.desc, 360)}</p>
    <a class="btn brand" href="https://www.youtube.com/watch?v=${v.id}" target="_blank" rel="noopener">${t("btn.watchOnYT")}</a>`;
  const thumb = el.querySelector(".videobox");
  thumb.addEventListener("click", ()=>{
    thumb.innerHTML = `<iframe src="https://www.youtube.com/embed/${v.id}?autoplay=1" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="${v.title}"></iframe>`;
  });
  return el;
}
function renderMini(arr){ const grid = $("#mini-grid"); grid.innerHTML = ""; arr.forEach(v => grid.appendChild(makeMiniCard(v))); }

function renderSeries(items){
  const SERIES_KEYWORDS = {
    "Saga Parasite Eve": ["parasite eve","parasite-eve","koudelka"],
    "Survival Horror PS1/PS2": ["resident evil","silent hill","dino crisis","fear effect","rule of rose","haunting ground"],
    "JRPG & Square": ["final fantasy","chrono","xenogears","vagrant story","valkyrie profile"]
  };
  const grid = $("#series-grid"); grid.innerHTML = "";
  for(const [name,keys] of Object.entries(SERIES_KEYWORDS)){
    const hits = items.filter(v => keys.some(k => words(v.title).includes(k))); if(!hits.length) continue;
    const top = hits.slice(0,3);
    const el = document.createElement("article");
    el.className = "card pad filterable";
    el.dataset.title = name; el.dataset.desc = top.map(x=>x.title).join(" ");
    el.innerHTML = `<div class="title">${name}</div>
      <p class="muted" style="margin-top:-2px">${top.length} videos</p>
      <div class="grid cols-3" style="margin-top:8px">
        ${top.map(v=>`<a class="btn" href="https://www.youtube.com/watch?v=${v.id}" target="_blank" rel="noopener">â–¶ ${truncate(v.title,38)}</a>`).join("")}
      </div>`;
    grid.appendChild(el);
  }
}

function showFallback(msg){
  $("#ultimo-titulo").textContent = msg || (LANG==='en' ? "Couldn't load playlist" : "No se pudo cargar la playlist");
  $("#ultimo-fecha").textContent = "";
  $("#ultimo-desc").textContent = LANG==='en' ? "Open the channel or try again later." : "TocÃ¡ el botÃ³n para ver el canal, o probÃ¡ mÃ¡s tarde.";
  if (FALLBACK_VIDEO_ID){
    const box = $("#ultimo-lite");
    box.className = "videobox";
    box.innerHTML = `<iframe src="https://www.youtube.com/embed/${FALLBACK_VIDEO_ID}" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
    $("#ultimo-ver").href = `https://www.youtube.com/watch?v=${FALLBACK_VIDEO_ID}`;
  } else {
    $("#ultimo-ver").href = "https://www.youtube.com/@TuCanal/videos";
  }
}

async function loadPlaylist(){
  try{
    const url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${PLAYLIST_ID}&maxResults=${MAX_RESULTS}&key=${API_KEY}`;
    const r = await fetch(url);
    const data = await r.json();
    if(!data.items){ console.error("Error YouTube:", data); showFallback(); return; }

    YT_ITEMS = data.items.map(i => ({
      id: i.snippet.resourceId.videoId,
      title: i.snippet.title,
      desc: i.snippet.description,
      date: i.snippet.publishedAt,
      thumb: (i.snippet.thumbnails?.maxres?.url || i.snippet.thumbnails?.high?.url || i.snippet.thumbnails?.medium?.url || "")
    }));

    renderUltimo(YT_ITEMS[0]);
    renderMini(YT_ITEMS.slice(1, 10));
    renderSeries(YT_ITEMS);

    const inp = $("#buscador");
    inp.addEventListener("input", ()=>{
      const q = words(inp.value);
      for(const card of $$(".filterable")){
        const hay = words(card.dataset.title + " " + (card.dataset.desc||"")).includes(q);
        card.style.display = (!q || hay) ? "" : "none";
      }
    });
  }catch(e){
    console.error(e);
    showFallback(LANG==='en' ? "Couldn't connect to YouTube" : "No se pudo conectar con YouTube");
  }
}

/* ================================
 *  NOTICIAS (Blogger JSONP)
 * ================================ */
function parseBloggerJson(data){
  const entries = data?.feed?.entry || [];
  return entries.map(e => {
    const rawHtml = e.summary?.$t || e.content?.$t || "";
    const textOnly = rawHtml.replace(/<[^>]+>/g, " ").trim();
    const titleRaw = (e.title?.$t || "").trim();
    const title = titleRaw || (textOnly ? textOnly.split(/\s+/).slice(0,12).join(" ") + "â€¦" : (LANG==='en'?'Untitled':'Sin tÃ­tulo'));
    const link  = (e.link || []).find(l=>l.rel==='alternate')?.href || '#';
    const date  = e.published?.$t || e.updated?.$t || new Date().toISOString();

    const thumbRaw =
      e['media$thumbnail']?.url ||
      extractImgFromHtml(rawHtml) ||
      DEFAULT_NEWS_IMAGE;

    const image = upsizeBloggerImage(thumbRaw, 800);
    const source = NEWS_BRAND_NAME;

    return { title, url: link, date, summary: textOnly, image, source };
  });
}
function renderNews(items){
  NEWS_ITEMS = items.slice(); // keep copia para re-render i18n
  const grid = $("#news-grid"); grid.innerHTML = "";
  $("#news-error").style.display = (items.length? "none":"block");
  items.forEach(n => {
    const card = document.createElement('article');
    card.className = "card pad filterable";
    card.dataset.title = n.title; card.dataset.desc = n.summary + " " + n.source;
    const imgTag = n.image ? `
      <img loading="lazy" src="${upsizeBloggerImage(n.image, 800)}"
           srcset="${upsizeBloggerImage(n.image,400)} 400w,
                   ${upsizeBloggerImage(n.image,800)} 800w,
                   ${upsizeBloggerImage(n.image,1200)} 1200w"
           sizes="(min-width: 900px) 33vw, 90vw"
           alt="">
    ` : "";
    card.innerHTML = `
      <div class="news-thumb">${imgTag}</div>
      <div class="news-meta">
        <span class="badge">${t("badge.news")}</span>
        <span>${n.source}</span> â€¢ <span>${timeAgo(n.date)}</span>
      </div>
      <div class="title">${n.title}</div>
      <p class="desc">${truncate(n.summary, 220)}</p>
      <a class="btn brand" href="${n.url}" target="_blank" rel="noopener">ðŸ“° ${LANG==='en'?'Read more':'Leer mÃ¡s'}</a>
    `;
    grid.appendChild(card);
  });
}
function loadNews(){
  // JSONP: inyectar <script> con callback global
  const cb = "onBloggerFeed_" + Math.random().toString(36).slice(2);
  window[cb] = (data) => {
    try{
      const items = parseBloggerJson(data);
      renderNews(items);
    }catch(e){
      console.error("Blogger parse:", e);
      $("#news-error").style.display = "block";
    }finally{
      delete window[cb];
      s.remove();
    }
  };
  const s = document.createElement("script");
  s.src = BLOGGER_JSONP + "&callback=" + cb;
  s.onerror = ()=> { $("#news-error").style.display = "block"; delete window[cb]; s.remove(); };
  document.body.appendChild(s);
}

/* ================================
 *  Contacto (Formspree)
 * ================================ */
(function(){
  const form = document.getElementById('contact-form');
  if (!form) return;
  form.action = `https://formspree.io/f/${FORMSPREE_ID}`;
  const result = document.getElementById('form-result');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    result.textContent = LANG==='en' ? 'Sendingâ€¦' : 'Enviandoâ€¦';
    try{
      const r = await fetch(form.action, {
        method:'POST',
        body: new FormData(form),
        headers: { 'Accept':'application/json' }
      });
      if(r.ok){
        result.textContent = LANG==='en' ? 'Message sent! I will reply soon.' : 'Â¡Mensaje enviado! Te respondo apenas pueda.';
        form.reset();
      }else{
        result.textContent = LANG==='en' ? 'Error sending. Please try again later.' : 'Hubo un error al enviar. ProbÃ¡ mÃ¡s tarde.';
      }
    }catch(err){
      result.textContent = LANG==='en' ? 'Could not send. Please try again later.' : 'No se pudo enviar. ProbÃ¡ mÃ¡s tarde.';
    }
  });
})();

/* ================================
 *  Boot
 * ================================ */
document.getElementById("year").textContent = new Date().getFullYear();
loadPlaylist();
loadNews();
applyI18n();
</script>
</body>
</html>

