<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Noticias â€” El Portal Gamer</title>

  <link rel="canonical" href="https://www.elportalgamer.com/news.html" />
  <link rel="icon" type="image/png" href="mago.png" />

  <!-- OG / Twitter -->
  <meta name="description" content="Noticias, actualidad gamer y retro de El Portal Gamer. Notas, rumores y curiosidades." />
  <meta property="og:title" content="Noticias â€” El Portal Gamer" />
  <meta property="og:description" content="Noticias, actualidad gamer y retro de El Portal Gamer. Notas, rumores y curiosidades." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.elportalgamer.com/news.html" />
  <meta property="og:image" content="https://www.elportalgamer.com/og.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Noticias â€” El Portal Gamer" />
  <meta name="twitter:description" content="Noticias, actualidad gamer y retro de El Portal Gamer. Notas, rumores y curiosidades." />
  <meta name="twitter:image" content="https://www.elportalgamer.com/og.jpg" />

  <style>
    :root{
      --bg:#121212; --surface:#1f1f1f; --text:#f0f0f0; --muted:#b5b5b5; --brand:#ff4500; --card:#171717;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial; background:var(--bg); color:var(--text)}
    header{position:sticky; top:0; z-index:5; background:#161616; border-bottom:1px solid #242424}
    .nav{max-width:1100px; margin:0 auto; display:flex; align-items:center; gap:16px; padding:12px 16px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; font-size:1.25rem; color:var(--brand)}
    .brand img{height:34px;width:auto;border-radius:6px}
    .nav a{color:#eaeaea;text-decoration:none;opacity:.9}
    .nav a:hover{opacity:1}
    .spacer{flex:1}
    .search{width:320px; max-width:55vw; padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0f0f0f; color:#fff}

    main{max-width:1100px; margin:20px auto; padding:0 16px}
    h1{font-size:1.5rem; margin:6px 0 10px}
    .sub{color:var(--muted); font-size:.95rem; margin:0 0 18px}
    .divider{height:6px; background:linear-gradient(90deg,#ff6a00,#ff4500,#ff6a00); border-radius:999px; margin:14px 0 18px}

    .grid{display:grid; gap:16px}
    .grid.cols-3{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}

    .card{background:var(--surface); border:1px solid #262626; border-radius:var(--radius); overflow:hidden}
    .card.pad{padding:14px}
    .title{font-weight:700; margin:6px 0 6px; font-size:1.05rem}
    .desc{color:#cfcfcf; font-size:.95rem; line-height:1.45; max-height:4.6em; overflow:hidden}
    .muted{color:var(--muted); font-size:.9rem}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:10px; border:1px solid #333; background:#151515; color:#fff; text-decoration:none}

    /* Mini UI */
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .controls{display:flex; gap:10px; align-items:center; margin:6px 0 12px}
    .controls input{padding:10px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#0f0f0f; color:#fff; width:280px; max-width:60vw}

    /* Noticias (cuadrado HD) */
    .news-thumb{position:relative; width:100%; padding-top:100%; background:#0e0e0e; border-radius:10px; overflow:hidden; border:1px solid #262626}
    .news-thumb img{position:absolute; inset:0; width:100%; height:100%; object-fit:cover}
    .news-meta{display:flex; gap:10px; align-items:center; color:#cfcfcf; font-size:.9rem; margin:6px 0 10px}
    .badge{font-size:.75rem; border:1px solid #333; padding:4px 8px; border-radius:999px; color:#ffcfbd; background:#1b0f0a}

    /* PaginaciÃ³n */
    .pager{display:flex; gap:10px; justify-content:center; align-items:center; margin:20px 0}
    .pager button{background:#1a1a1a; border:1px solid #333; color:#fff; padding:10px 14px; border-radius:10px; cursor:pointer}
    .pager button[disabled]{opacity:.45; cursor:not-allowed}
    .pager .info{color:var(--muted); font-size:.95rem}

    footer{margin:40px 0 20px; color:#9b9b9b; text-align:center}
    @media (max-width:560px){ .search{width:100%} .nav{flex-wrap:wrap} }
  </style>
</head>
<body>
<header>
  <div class="nav">
    <a class="brand" href="/"><img src="mago.png" alt="Logo" />El Portal Gamer</a>
    <a href="/">Inicio</a>
    <a href="/videos.html">Videos</a>
    <strong style="opacity:1">Noticias</strong>
    <div class="spacer"></div>
    <input id="q" class="search" type="search" placeholder="Buscar noticiaâ€¦" />
  </div>
</header>

<main>
  <h1>Noticias</h1>
  <div class="divider" aria-hidden="true"></div>

  <div class="controls">
    <input id="search" type="search" placeholder="Filtrar por tÃ­tulo o resumenâ€¦" />
  </div>

  <section>
    <div class="grid cols-3" id="news-grid"></div>
    <div class="pager" id="pager" hidden>
      <button id="prev">â€¹ Anteriores</button>
      <span class="info" id="pageinfo"></span>
      <button id="next">Siguientes â€º</button>
    </div>
  </section>
</main>

<footer>Â© 2025 El Portal Gamer</footer>

<script>
/* ===== Config ===== */
const BLOGGER_FEED = "https://portalgamerok.blogspot.com/feeds/posts/summary?alt=json&max-results=40&orderby=published";
const FALLBACK_JSON = "news.json";
const PAGE_SIZE = 9;

/* ===== Helpers ===== */
const $ = (s, p=document) => p.querySelector(s);
const $$ = (s, p=document) => [...p.querySelectorAll(s)];
const truncate = (str, n) => (str||"").length>n ? str.slice(0,n).replace(/\s+\S*$/,'')+"â€¦" : str;
const words = (x)=> (x||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase();
const strip = (html)=> (html||"").replace(/<[^>]+>/g, " ").replace(/\s+/g," ").trim();

function upsizeBloggerImage(url, size = 800){
  if(!url) return "";
  return url
    .replace(/\/s\d+(-c)?\//, `/s${size}/`)
    .replace(/=s\d+(-c)?/, `=s${size}`)
    .replace(/\/w\d+-h\d+(-c)?\//, `/s${size}/`);
}
function extractImgFromHtml(html){
  const m = (html||"").match(/<img[^>]+src=["']([^"']+)["']/i);
  return m ? m[1] : "";
}
function timeAgo(iso){
  const d = new Date(iso); const diff = (Date.now() - d.getTime())/1000;
  const units = [[31536000,'a'],[2592000,'m'],[604800,'sem'],[86400,'d'],[3600,'h'],[60,'min']];
  for(const [s,n] of units){ if(diff>=s) return `${Math.floor(diff/s)} ${n}`; }
  return 'ahora';
}

/* ===== Parse Blogger JSON ===== */
function parseBloggerJson(data){
  const entries = data?.feed?.entry || [];
  return entries.map(e => {
    const rawHtml = e.summary?.$t || e.content?.$t || "";
    const textOnly = strip(rawHtml);
    const titleRaw = (e.title?.$t || "").trim();
    const title = titleRaw || (textOnly ? textOnly.split(/\s+/).slice(0,12).join(" ") + "â€¦" : "Sin tÃ­tulo");
    const link  = (e.link || []).find(l=>l.rel==='alternate')?.href || '#';
    const date  = e.published?.$t || e.updated?.$t || new Date().toISOString();
    const thumbRaw = e['media$thumbnail']?.url || extractImgFromHtml(rawHtml) || "og.jpg";
    const image = upsizeBloggerImage(thumbRaw, 1200);
    const tags = (e.category||[]).map(c=>c.term).slice(0,5);
    return { title, url: link, date, summary: textOnly, image, tags };
  }).sort((a,b)=> new Date(b.date)-new Date(a.date));
}

/* ===== Render ===== */
function cardHTML(n){
  const imgTag = n.image ? `
    <img loading="lazy" src="${n.image}"
         srcset="${upsizeBloggerImage(n.image,400)} 400w,
                 ${upsizeBloggerImage(n.image,800)} 800w,
                 ${upsizeBloggerImage(n.image,1200)} 1200w"
         sizes="(min-width: 900px) 33vw, 90vw"
         alt="">` : "";
  return `
    <article class="card pad filterable" data-title="${n.title}" data-desc="${n.summary}">
      <div class="news-thumb">${imgTag}</div>
      <div class="news-meta">
        <span class="badge">Noticia</span>
        <span>${new Date(n.date).toLocaleDateString()}</span> â€¢ <span>${timeAgo(n.date)}</span>
      </div>
      <div class="title">${n.title}</div>
      <p class="desc">${truncate(n.summary, 240)}</p>
      <a class="btn" href="${n.url}" target="_blank" rel="noopener">ðŸ“° Leer mÃ¡s</a>
    </article>`;
}

let ALL = [];
let VIEW = [];
let page = 1;

function applyFilter(){
  const q = words($("#search").value);
  VIEW = !q ? [...ALL] :
    ALL.filter(n => words(n.title + " " + n.summary).includes(q));
  page = 1;
  renderPage();
  renderPager();
  injectLD();
}

function renderPage(){
  const start = (page-1)*PAGE_SIZE;
  const slice = VIEW.slice(start, start+PAGE_SIZE);
  $("#news-grid").innerHTML = slice.map(cardHTML).join("");
}
function renderPager(){
  const total = Math.max(1, Math.ceil(VIEW.length / PAGE_SIZE));
  $("#pager").hidden = total<=1;
  $("#prev").disabled = (page<=1);
  $("#next").disabled = (page>=total);
  $("#pageinfo").textContent = `PÃ¡gina ${page} de ${total}`;
}

/* ===== JSON-LD (ItemList) ===== */
function injectLD(){
  const old = document.getElementById("ld-news");
  if (old) old.remove();
  const start = (page-1)*PAGE_SIZE;
  const slice = VIEW.slice(start, start+PAGE_SIZE);
  const list = {
    "@context":"https://schema.org",
    "@type":"ItemList",
    "itemListElement": slice.map((n,i)=>({
      "@type":"ListItem",
      "position": start + i + 1,
      "url": n.url,
      "name": n.title
    }))
  };
  const s = document.createElement("script");
  s.type="application/ld+json"; s.id="ld-news";
  s.textContent = JSON.stringify(list);
  document.head.appendChild(s);
}

/* ===== Load ===== */
async function loadNews(){
  try{
    const r = await fetch(BLOGGER_FEED, {cache:'no-store'});
    const data = await r.json();
    ALL = parseBloggerJson(data);
  }catch(e){
    // Fallback local
    try{
      const r2 = await fetch(FALLBACK_JSON, {cache:'no-store'});
      const items = await r2.json();
      ALL = (items||[]).map(n=>({
        title:n.title, url:n.url, date:n.date, summary:n.summary||"", image:n.image||"og.jpg", tags:n.tags||[]
      })).sort((a,b)=> new Date(b.date)-new Date(a.date));
    }catch(_){}
  }
  VIEW = [...ALL];
  renderPage(); renderPager(); injectLD();
}

$("#search").addEventListener("input", applyFilter);
$("#q").addEventListener("input", (e)=>{ $("#search").value = e.target.value; applyFilter(); });
$("#prev").addEventListener("click", ()=>{ if(page>1){ page--; renderPage(); renderPager(); injectLD(); }});
$("#next").addEventListener("click", ()=>{ const total=Math.ceil(VIEW.length/PAGE_SIZE); if(page<total){ page++; renderPage(); renderPager(); injectLD(); }});

loadNews();
</script>
</body>
</html>
