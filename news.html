<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Noticias â€” El Portal Gamer</title>
  <link rel="icon" type="image/png" href="mago.png" />
  <style>
    :root{ --bg:#121212; --surface:#1f1f1f; --text:#f0f0f0; --muted:#b5b5b5; --brand:#ff4500; --radius:14px; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu}
    header{position:sticky;top:0;background:#161616;border-bottom:1px solid #242424;z-index:5}
    .nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:16px;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:1.1rem;color:var(--brand)}
    .brand img{height:28px;border-radius:6px}
    .nav a{color:#eaeaea;text-decoration:none;opacity:.9;padding:6px 8px;border-radius:10px}
    .nav a:hover{opacity:1;background:#1b1b1b}
    main{max-width:1100px;margin:18px auto;padding:0 16px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
    .card{background:#1f1f1f;border:1px solid #262626;border-radius:var(--radius);overflow:hidden}
    .pad{padding:14px}
    .news-thumb{position:relative;width:100%;padding-top:100%;background:#0e0e0e;border-bottom:1px solid #262626}
    .news-thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid #333;background:#151515;color:#fff;text-decoration:none}
    .btn.min{padding:8px 10px}
    .badge{font-size:.75rem;border:1px solid #333;padding:4px 8px;border-radius:999px;color:#ffcfbd;background:#1b0f0a}
    .meta{display:flex;gap:10px;align-items:center;color:#cfcfcf;font-size:.9rem;margin:8px 0 10px}
    article.post{background:#1f1f1f;border:1px solid #262626;border-radius:14px;padding:18px}
    article.post h1{margin:0 0 8px}
    article.post .hero{width:100%;max-height:520px;object-fit:cover;border-radius:12px}
    article.post .content{margin-top:14px;line-height:1.6;color:#e8e8e8}
    .divider{height:8px;border-radius:999px;background:linear-gradient(90deg,#ff6a00,#ff3b00,#ff6a00);margin:18px 0}
  </style>
</head>
<body>
<header>
  <div class="nav">
    <a class="brand" href="index.html"><img src="mago.png" alt="">El Portal Gamer</a>
    <a href="index.html#news">Noticias</a>
    <a href="index.html#mini">ReseÃ±as</a>
    <a href="videos.html">Videos</a>
  </div>
</header>

<main id="app">
  <h2>Noticias</h2>
  <div class="divider"></div>
  <div id="list" class="grid"></div>
  <div id="post"></div>
</main>

<script>
const $=(s,p=document)=>p.querySelector(s);
const $$=(s,p=document)=>[...p.querySelectorAll(s)];
const q=(k)=> new URLSearchParams(location.search).get(k);
function hq(url,size=1600){
  if(!url) return "";
  let u=url;
  u=u.replace(/\/s\d+[^/]*\//, `/s${size}/`);
  u=u.replace(/\/w\d+-h\d+(?:-[a-z])?\//, `/s${size}/`);
  u=u.replace(/=s\d+(?:-[a-z])?/, `=s${size}`);
  u=u.replace(/([?&])imgmax=\d+/, `$1imgmax=${size}`);
  if(/blogger\.googleusercontent\.com/.test(u) && !/[?&]imgmax=/.test(u)){
    u+=(u.includes("?")?"&":"?")+`imgmax=${size}`;
  }
  return u;
}
function ensureHiRes(img, original){
  if (img.naturalWidth && img.naturalWidth < 600){
    img.src = hq(original || img.currentSrc || img.src, 1600);
  }
}
function timeAgo(iso){const d=new Date(iso);const diff=(Date.now()-d)/1000;const u=[[31536000,'a'],[2592000,'m'],[604800,'sem'],[86400,'d'],[3600,'h'],[60,'min']];for(const[s,n] of u){if(diff>=s)return`${Math.floor(diff/s)} ${n}`;}return"ahora";}
function shareIt(url,title){const abs=new URL(url,location.href).toString(); if(navigator.share)navigator.share({title,url:abs}).catch(()=>{}); else{navigator.clipboard?.writeText(abs); alert("Enlace copiado");}}
function card(n){
  const div=document.createElement('article');div.className='card';
  div.innerHTML = `
    <a class="news-thumb" href="news.html?id=${encodeURIComponent(n.id)}">
      <img loading="lazy" decoding="async" referrerpolicy="no-referrer"
           src="${hq(n.image,1600)}"
           srcset="${hq(n.image,400)} 400w, ${hq(n.image,800)} 800w, ${hq(n.image,1200)} 1200w, ${hq(n.image,1600)} 1600w"
           sizes="(min-width: 900px) 33vw, 90vw" alt="">
    </a>
    <div class="pad">
      <div class="meta"><span class="badge">Noticia</span><span>${new Date(n.date).toLocaleDateString()}</span> â€¢ <span>${timeAgo(n.date)}</span></div>
      <h3 style="margin:.2rem 0 .4rem">${n.title}</h3>
      <p style="color:#cfcfcf">${(n.summary||"").slice(0,220)}â€¦</p>
      <div class="row">
        <a class="btn min" href="news.html?id=${encodeURIComponent(n.id)}">ðŸ“° Leer</a>
        <button class="btn min" onclick="shareIt('news.html?id=${encodeURIComponent(n.id)}','${n.title.replace(/"/g,'&quot;')}')">ðŸ”— Compartir</button>
      </div>
    </div>`;
  const img=div.querySelector('img'); img.addEventListener('load',()=>ensureHiRes(img,n.image));
  return div;
}
async function loadList(){
  const r = await fetch('news.json', {cache:'no-store'}); const arr = await r.json();
  const list = $('#list'); list.innerHTML=''; arr.forEach(n=> list.appendChild(card(n)));
}
async function loadPost(id){
  const listBox = $('#list'); listBox.style.display='none';
  const r = await fetch('news.json',{cache:'no-store'}); const arr = await r.json();
  const n = arr.find(x=> (x.id||"")===(id||"")) || arr[0];
  const box = $('#post');
  box.innerHTML = `
    <article class="post">
      <h1>${n.title}</h1>
      <img class="hero" src="${hq(n.image,1600)}" alt="">
      <div class="meta" style="margin-top:8px"><span class="badge">Noticia</span><span>${new Date(n.date).toLocaleDateString()}</span> â€¢ <span>${timeAgo(n.date)}</span></div>
      <div class="content">
        <p>${(n.summary||"").replace(/&nbsp;/g,' ').slice(0,1000)}â€¦</p>
      </div>
      <div class="row" style="margin-top:10px">
        <a class="btn" href="index.html#news">â¬… Volver</a>
        <button class="btn" onclick="shareIt(location.href,'${n.title.replace(/"/g,'&quot;')}')">ðŸ”— Compartir</button>
      </div>
    </article>`;
  const hero = box.querySelector('.hero'); hero.addEventListener('load',()=>ensureHiRes(hero,n.image));
}
const id = q('id');
if(id) loadPost(id); else loadList();
</script>
</body>
</html>
